---
import BaseLayout from '../../layouts/BaseLayout.astro';
import dictionaryData from '../../data/dictionary.json';

const lang = 'en';
const entries = dictionaryData.entries;
const sources = dictionaryData.sources;
---

<BaseLayout title="Dictionary" description="Searchable glossary of Vedāntic terminology." lang={lang}>
  <section class="section">
    <h1 class="section-title">Dictionary</h1>
    <p class="muted">Searchable glossary of Vedāntic terminology from traditional sources.</p>
  </section>

  <section class="section">
    <div class="search-box">
      <input
        type="text"
        id="dict-search"
        placeholder="Search terms (Sanskrit, Telugu, or English)..."
        autocomplete="off"
      />
      <span class="search-count" id="search-count">{entries.length} terms</span>
    </div>
  </section>

  <section class="section">
    <div class="dict-entries" id="dict-entries">
      {entries.map((entry) => (
        <article class="dict-entry" data-term={entry.term} data-devanagari={entry.devanagari} data-iast={entry.iast} data-english={entry.english?.toLowerCase() || ''} data-telugu={entry.telugu}>
          <div class="dict-header">
            <span class="dict-term">{entry.term}</span>
            <span class="dict-devanagari">{entry.devanagari}</span>
            <span class="dict-iast">({entry.iast})</span>
          </div>
          <div class="dict-content">
            {entry.english && <p class="dict-english">{entry.english}</p>}
            <details class="dict-telugu-wrapper">
              <summary>Telugu original</summary>
              <p class="dict-telugu">{entry.telugu}</p>
            </details>
          </div>
          <div class="dict-meta">
            <span class="dict-source">{sources[entry.source]?.name}</span>
          </div>
        </article>
      ))}
    </div>

    <p class="no-results" id="no-results" style="display: none;">No matching terms found.</p>
  </section>
</BaseLayout>

<style>
  .search-box {
    position: relative;
    max-width: 500px;
  }

  #dict-search {
    width: 100%;
    padding: 0.875rem 1rem;
    font-size: 1rem;
    font-family: inherit;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text);
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  #dict-search:focus {
    outline: none;
    border-color: var(--accent-warm);
    box-shadow: 0 0 0 3px rgba(176, 141, 122, 0.15);
  }

  #dict-search::placeholder {
    color: var(--muted);
  }

  .search-count {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8rem;
    color: var(--muted);
  }

  .dict-entries {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .dict-entry {
    padding: 1.25rem;
    background: var(--surface);
    border-radius: 8px;
    border: 1px solid var(--border);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .dict-entry:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
  }

  .dict-entry.hidden {
    display: none;
  }

  .dict-header {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    flex-wrap: wrap;
  }

  .dict-term {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--accent-warm);
  }

  .dict-devanagari {
    font-size: 1.1rem;
    color: var(--text);
  }

  .dict-iast {
    font-size: 0.9rem;
    font-style: italic;
    color: var(--muted);
  }

  .dict-content {
    margin-bottom: 0.75rem;
  }

  .dict-english {
    margin: 0 0 0.75rem 0;
    line-height: 1.6;
  }

  .dict-telugu-wrapper {
    margin-top: 0.5rem;
  }

  .dict-telugu-wrapper summary {
    cursor: pointer;
    color: var(--muted);
    font-size: 0.85rem;
  }

  .dict-telugu-wrapper summary:hover {
    color: var(--accent-cool);
  }

  .dict-telugu {
    margin: 0.5rem 0 0 0;
    padding: 0.75rem;
    background: var(--background);
    border-radius: 4px;
    font-size: 0.9rem;
    line-height: 1.7;
    color: var(--muted);
  }

  .dict-meta {
    font-size: 0.75rem;
    color: var(--muted);
    opacity: 0.7;
  }

  .no-results {
    text-align: center;
    color: var(--muted);
    padding: 2rem;
  }
</style>

<script>
  const searchInput = document.getElementById('dict-search') as HTMLInputElement;
  const entriesContainer = document.getElementById('dict-entries');
  const searchCount = document.getElementById('search-count');
  const noResults = document.getElementById('no-results');
  const entries = entriesContainer?.querySelectorAll('.dict-entry');

  searchInput?.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();
    let visibleCount = 0;

    entries?.forEach((entry) => {
      const el = entry as HTMLElement;
      const term = el.dataset.term?.toLowerCase() || '';
      const devanagari = el.dataset.devanagari || '';
      const iast = el.dataset.iast?.toLowerCase() || '';
      const english = el.dataset.english || '';
      const telugu = el.dataset.telugu || '';

      const matches = !query ||
        term.includes(query) ||
        devanagari.includes(query) ||
        iast.includes(query) ||
        english.includes(query) ||
        telugu.includes(query);

      if (matches) {
        el.classList.remove('hidden');
        visibleCount++;
      } else {
        el.classList.add('hidden');
      }
    });

    if (searchCount) {
      searchCount.textContent = `${visibleCount} term${visibleCount !== 1 ? 's' : ''}`;
    }

    if (noResults) {
      noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }
  });
</script>
