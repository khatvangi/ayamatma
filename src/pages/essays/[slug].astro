---
import BaseLayout from '../../layouts/BaseLayout.astro';
import LanguagePill from '../../components/LanguagePill.astro';
import { getCollection } from 'astro:content';
import { findBySlugAndLang, getSlugFromPath } from '../../lib/content';

export async function getStaticPaths() {
  const entries = await getCollection('essays');
  return entries
    .filter((entry) => entry.data.lang === 'en')
    .map((entry) => ({ params: { slug: getSlugFromPath(entry.data.paths.en) } }));
}

const { slug } = Astro.params;
const entries = await getCollection('essays');
const entry = findBySlugAndLang(entries, slug, 'en');
if (!entry) {
  return Astro.redirect('/essays');
}
const { Content, headings } = await entry.render();
const toc = headings.filter((heading) => heading.depth <= 3);
---

<BaseLayout
  title={`${entry.data.title} | Ayamatma`}
  description={entry.data.description}
  lang="en"
>
  <article class="essay-layout">
    <header class="essay-header">
      <h1 class="essay-title">{entry.data.title}</h1>
      {entry.data.claim ? <p class="essay-claim">{entry.data.claim}</p> : null}
      <div class="essay-meta muted">
        {entry.data.date} · {entry.data.reading_time ? `${entry.data.reading_time} min read` : ''} · v{entry.data.version}
      </div>
    </header>

    <div class="essay-body">
      <div class="essay-content prose">
        <Content />
      </div>

      <aside class="essay-sidebar">
        {toc.length ? (
          <nav class="essay-toc">
            <div class="eyebrow">Contents</div>
            <ul>
              {toc.map((heading) => (
                <li>
                  <a href={`#${heading.slug}`}>{heading.text}</a>
                </li>
              ))}
            </ul>
          </nav>
        ) : null}

        <div class="verse-panel" id="verse-panel">
          <div class="verse-panel-content" id="verse-panel-content">
            <!-- populated by JS on hover -->
          </div>
        </div>
      </aside>
    </div>

    <footer class="essay-footer">
      <LanguagePill currentLang="en" paths={entry.data.paths} />
      {entry.data.tags ? (
        <div class="essay-tags">
          {entry.data.tags.map((tag) => (
            <span class="pill">{tag}</span>
          ))}
        </div>
      ) : null}
    </footer>
  </article>
</BaseLayout>

<style>
  /* ═══════════════════════════════════════════════════════════════
     MEDITATIVE ESSAY LAYOUT
     designed for slow, contemplative reading of dense philosophy
     ═══════════════════════════════════════════════════════════════ */

  .essay-layout {
    max-width: 1100px;
    margin: 0 auto;
    padding: 4rem 2rem 6rem;
  }

  .essay-header {
    max-width: 600px;  /* narrower for meditation */
    margin: 0 auto 4rem;
    text-align: center;
  }

  .essay-title {
    font-family: 'Fraunces', Georgia, serif;
    font-size: 2.25rem;
    font-weight: 300;  /* lighter weight = calmer */
    line-height: 1.3;
    margin: 0 0 1.5rem;
    color: var(--text);
    letter-spacing: -0.01em;
  }

  .essay-claim {
    font-family: 'Fraunces', Georgia, serif;
    font-size: 1.05rem;
    color: var(--muted);
    margin: 0 0 1.5rem;
    font-style: italic;
    line-height: 1.7;
  }

  .essay-meta {
    font-size: 0.8rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .essay-body {
    display: grid;
    grid-template-columns: minmax(0, 640px) 260px;  /* narrower content */
    gap: 5rem;
    align-items: start;
    justify-content: center;
  }

  .essay-content {
    font-size: 1.15rem;
    line-height: 2.1;  /* generous breathing room */
    letter-spacing: 0.01em;
  }

  /* paragraphs need space to breathe */
  .essay-content p {
    margin-bottom: 1.75rem;
  }

  /* ─────────────────────────────────────────────────────────────────
     PULL QUOTES — meditation pauses with left accent
     subtle vertical line, not a section break
     ───────────────────────────────────────────────────────────────── */
  .essay-content :global(.pullquote) {
    display: block;
    font-family: 'Fraunces', Georgia, serif;
    font-size: 1.2rem;
    font-weight: 400;
    font-style: italic;
    line-height: 1.7;
    color: var(--text);

    /* left accent line */
    border-left: 3px solid var(--accent-warm);
    padding-left: 1.25rem;
    margin: 2rem 0;

    /* subtle background */
    background: var(--accent-warm-soft);
    padding: 1rem 1.25rem;
    border-radius: 0 8px 8px 0;
  }

  /* ─────────────────────────────────────────────────────────────────
     SECTION DIVIDERS — breathing markers between thoughts
     ───────────────────────────────────────────────────────────────── */
  .essay-content :global(hr) {
    border: none;
    text-align: center;
    margin: 3rem 0;
  }

  .essay-content :global(hr)::before {
    content: '॰ ॰ ॰';
    color: var(--accent-cool);
    opacity: 0.5;
    font-size: 1rem;
    letter-spacing: 0.3em;
  }

  /* hide section headings in prose - they're in the TOC sidebar */
  .essay-content h2 {
    font-size: 0;
    line-height: 0;
    height: 0;
    margin: 0;
    padding: 0;
    overflow: hidden;
    color: transparent;
  }

  .essay-sidebar {
    position: sticky;
    top: 2rem;
  }

  .essay-toc {
    margin-bottom: 2rem;
  }

  .essay-toc ul {
    list-style: none;
    padding: 0;
    margin: 0.75rem 0 0;
  }

  .essay-toc li {
    margin-bottom: 0.5rem;
  }

  .essay-toc a {
    font-size: 0.85rem;
    color: var(--muted);
  }

  .essay-toc a:hover {
    color: var(--accent-cool);
  }

  .verse-panel {
    background: var(--bg-paper);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent-warm);
    border-radius: 8px;
    padding: 1rem;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 200ms ease, transform 200ms ease;
    min-height: 100px;
  }

  .verse-panel.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .verse-panel-content {
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .verse-panel-content .verse-sanskrit {
    font-size: 1.05rem;
    font-weight: 500;
    line-height: 1.7;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-light);
    color: var(--text);
  }

  .verse-panel-content .verse-iast {
    font-style: italic;
    color: var(--muted);
    margin-bottom: 1rem;
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .verse-panel-content .verse-english {
    color: var(--text-soft);
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .verse-panel-content .verse-source {
    margin-top: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border-light);
    font-size: 0.8rem;
    color: var(--accent-cool);
  }

  .verse-panel-content .verse-source a {
    color: inherit;
  }

  .essay-footer {
    max-width: 720px;
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border);
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }

  .essay-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  /* ─────────────────────────────────────────────────────────────────
     RESPONSIVE — meditation on any screen
     ───────────────────────────────────────────────────────────────── */
  @media (max-width: 1000px) {
    .essay-body {
      grid-template-columns: 1fr;
      max-width: 600px;
      margin: 0 auto;
    }

    .essay-sidebar {
      position: static;
      order: -1;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }

    .verse-panel {
      display: none;
    }
  }

  @media (max-width: 720px) {
    .essay-layout {
      padding: 3rem 1.5rem 4rem;
    }

    .essay-header {
      margin-bottom: 3rem;
    }

    .essay-title {
      font-size: 1.75rem;
      font-weight: 400;
    }

    .essay-content {
      font-size: 1.05rem;
      line-height: 2;
    }

    .essay-content :global(.pullquote) {
      font-size: 1.1rem;
      padding: 0.85rem 1rem;
      margin: 1.5rem 0;
    }
  }

  /* extra small screens — still contemplative */
  @media (max-width: 480px) {
    .essay-layout {
      padding: 2rem 1.25rem 3rem;
    }

    .essay-title {
      font-size: 1.5rem;
    }

    .essay-content {
      font-size: 1rem;
      line-height: 1.9;
    }

    .essay-content :global(.pullquote) {
      font-size: 1rem;
      padding: 0.75rem 0.85rem;
    }
  }
</style>

<script is:inline>
  // verse data - could be moved to a JSON file
  var verses = {
    'bg-2-50': {
      sanskrit: 'बुद्धियुक्तो जहातीह उभे सुकृतदुष्कृते । तस्माद्योगाय युज्यस्व योगः कर्मसु कौशलम् ॥',
      iast: 'buddhiyukto jahātīha ubhe sukṛtaduṣkṛte / tasmādyogāya yujyasva yogaḥ karmasu kauśalam',
      english: 'Endowed with wisdom, one casts off both good and evil deeds. Therefore devote yourself to Yoga—Yoga is skill in action.',
      source: 'Bhagavad Gita 2.50',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=2&field_nsutra_value=50'
    },
    'bg-2-48': {
      sanskrit: 'योगस्थः कुरु कर्माणि सङ्गं त्यक्त्वा धनञ्जय । सिद्ध्यसिद्ध्योः समो भूत्वा समत्वं योग उच्यते ॥',
      iast: 'yogasthaḥ kuru karmāṇi saṅgaṃ tyaktvā dhanañjaya / siddhyasiddhyoḥ samo bhūtvā samatvaṃ yoga ucyate',
      english: 'Established in Yoga, perform actions, O Dhananjaya, abandoning attachment. Remain the same in success and failure—equanimity is called Yoga.',
      source: 'Bhagavad Gita 2.48',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=2&field_nsutra_value=48'
    },
    'bg-9-22': {
      sanskrit: 'अनन्याश्चिन्तयन्तो मां ये जनाः पर्युपासते । तेषां नित्याभियुक्तानां योगक्षेमं वहाम्यहम् ॥',
      iast: 'ananyāścintayanto māṃ ye janāḥ paryupāsate / teṣāṃ nityābhiyuktānāṃ yogakṣemaṃ vahāmyaham',
      english: 'Those who worship Me alone, thinking of no other, to those ever-united souls, I provide what they lack and preserve what they have.',
      source: 'Bhagavad Gita 9.22',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=9&field_nsutra_value=22'
    },
    'bg-6-23': {
      sanskrit: 'तं विद्याद् दुःखसंयोगवियोगं योगसंज्ञितम् । स निश्चयेन योक्तव्यो योगोऽनिर्विण्णचेतसा ॥',
      iast: 'taṃ vidyād duḥkhasaṃyogaviyogaṃ yogasaṃjñitam / sa niścayena yoktavyo yogo\'nirviṇṇacetasā',
      english: 'Know that which is called Yoga to be the severance of union with sorrow. This Yoga should be practiced with determination and an undismayed mind.',
      source: 'Bhagavad Gita 6.23',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=6&field_nsutra_value=23'
    },
    'bg-3-3': {
      sanskrit: 'लोकेऽस्मिन् द्विविधा निष्ठा पुरा प्रोक्ता मयानघ । ज्ञानयोगेन साङ्ख्यानां कर्मयोगेन योगिनाम् ॥',
      iast: 'loke\'smin dvividhā niṣṭhā purā proktā mayānagha / jñānayogena sāṅkhyānāṃ karmayogena yoginām',
      english: 'In this world, O sinless one, a twofold path was taught by Me of old: the path of knowledge for the contemplative, and the path of action for the active.',
      source: 'Bhagavad Gita 3.3',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=3&field_nsutra_value=3'
    },
    'ys-1-2': {
      sanskrit: 'योगश्चित्तवृत्तिनिरोधः ॥',
      iast: 'yogaścittavṛttinirodhaḥ',
      english: 'Yoga is the cessation of the fluctuations of the mind.',
      source: 'Yoga Sutras 1.2',
      url: 'https://www.swamij.com/yoga-sutras-10104.htm#1.2'
    },
    'ys-2-29': {
      sanskrit: 'यमनियमासनप्राणायामप्रत्याहारधारणाध्यानसमाधयोऽष्टावङ्गानि ॥',
      iast: 'yamaniyamāsanaprāṇāyāmapratyāhāradhāraṇādhyānasamādhayo\'ṣṭāvaṅgāni',
      english: 'The eight limbs are: yama, niyama, āsana, prāṇāyāma, pratyāhāra, dhāraṇā, dhyāna, and samādhi.',
      source: 'Yoga Sutras 2.29',
      url: 'https://www.swamij.com/yoga-sutras-22829.htm#2.29'
    },
    'isa-shanti': {
      sanskrit: 'ॐ पूर्णमदः पूर्णमिदं पूर्णात्पूर्णमुदच्यते । पूर्णस्य पूर्णमादाय पूर्णमेवावशिष्यते ॥',
      iast: 'oṃ pūrṇamadaḥ pūrṇamidaṃ pūrṇātpūrṇamudacyate / pūrṇasya pūrṇamādāya pūrṇamevāvaśiṣyate',
      english: 'That is Whole. This is Whole. From the Whole, the Whole arises. When the Whole is taken from the Whole, the Whole alone remains.',
      source: 'Īśāvāsya Upaniṣad, Śānti Mantra',
      url: 'https://upanishads.org.in/upanishads/1'
    },
    'ait-3-3': {
      sanskrit: 'प्रज्ञानं ब्रह्म ॥',
      iast: 'prajñānaṃ brahma',
      english: 'Consciousness is Brahman.',
      source: 'Aitareya Upaniṣad 3.1.3',
      url: 'https://upanishads.org.in/upanishads/14/3/1/3'
    },
    'bg-11-54': {
      sanskrit: 'भक्त्या त्वनन्यया शक्य अहमेवंविधोऽर्जुन । ज्ञातुं द्रष्टुं च तत्त्वेन प्रवेष्टुं च परन्तप ॥',
      iast: 'bhaktyā tvananyayā śakya ahamevaṃvidho\'rjuna / jñātuṃ draṣṭuṃ ca tattvena praveṣṭuṃ ca parantapa',
      english: 'But by exclusive devotion alone, O Arjuna, can I be known, seen in truth, and entered into, O scorcher of foes.',
      source: 'Bhagavad Gita 11.54',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=11&field_nsutra_value=54'
    },
    'bg-16-24': {
      sanskrit: 'तस्माच्छास्त्रं प्रमाणं ते कार्याकार्यव्यवस्थितौ । ज्ञात्वा शास्त्रविधानोक्तं कर्म कर्तुमिहार्हसि ॥',
      iast: 'tasmācchāstraṃ pramāṇaṃ te kāryākāryavyavasthitau / jñātvā śāstravidhānoktaṃ karma kartumihārhasi',
      english: 'Therefore, let the Scripture be your authority in determining what should and should not be done. Knowing what is prescribed by scriptural rules, you should perform action here.',
      source: 'Bhagavad Gita 16.24',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=16&field_nsutra_value=24'
    },
    'bg-16-23': {
      sanskrit: 'यः शास्त्रविधिमुत्सृज्य वर्तते कामकारतः । न स सिद्धिमवाप्नोति न सुखं न परां गतिम् ॥',
      iast: 'yaḥ śāstravidhimutsṛjya vartate kāmakārataḥ / na sa siddhimavāpnoti na sukhaṃ na parāṃ gatim',
      english: 'He who casts aside the ordinances of Scripture and acts under the impulse of desire attains not perfection, nor happiness, nor the supreme goal.',
      source: 'Bhagavad Gita 16.23',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=16&field_nsutra_value=23'
    },
    'vc-31': {
      sanskrit: 'मोक्षसाधनसामग्र्यां भक्तिरेव गरीयसी । स्वस्वरूपानुसन्धानं भक्तिरित्यभिधीयते ॥',
      iast: 'mokṣasādhanasāmagryāṃ bhaktireva garīyasī / svasvarūpānusandhānaṃ bhaktirityabhidhīyate',
      english: 'Among the means for liberation, Bhakti is supreme. Constant contemplation of one\'s own true nature is called Bhakti.',
      source: 'Vivekacūḍāmaṇi 31',
      url: 'https://www.wisdomlib.org/hinduism/book/vivekachudamani/d/doc145083.html'
    },
    'tai-2-1': {
      sanskrit: 'सत्यं ज्ञानमनन्तं ब्रह्म ॥',
      iast: 'satyaṃ jñānamanantaṃ brahma',
      english: 'Brahman is Truth, Knowledge, Infinite.',
      source: 'Taittirīya Upaniṣad 2.1.1',
      url: 'https://upanishads.org.in/upanishads/4/2/1'
    },
    'brsu-1-1-2': {
      sanskrit: 'जन्माद्यस्य यतः ॥',
      iast: 'janmādyasya yataḥ',
      english: 'That from which the origin, sustenance, and dissolution of this universe proceeds.',
      source: 'Brahma Sūtra 1.1.2',
      url: 'https://www.wisdomlib.org/hinduism/book/brahma-sutras/d/doc62753.html'
    },
    'bg-9-4': {
      sanskrit: 'मया ततमिदं सर्वं जगदव्यक्तमूर्तिना । मत्स्थानि सर्वभूतानि न चाहं तेष्ववस्थितः ॥',
      iast: 'mayā tatamidaṃ sarvaṃ jagadavyaktamūrtinā / matsthāni sarvabhūtāni na cāhaṃ teṣvavasthitaḥ',
      english: 'By Me, in My unmanifested form, all this universe is pervaded. All beings exist in Me, but I do not dwell in them.',
      source: 'Bhagavad Gita 9.4',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=9&field_nsutra_value=4'
    },
    'katha-1-2-18': {
      sanskrit: 'न जायते म्रियते वा विपश्चिन्नायं कुतश्चिन्न बभूव कश्चित् । अजो नित्यः शाश्वतोऽयं पुराणो न हन्यते हन्यमाने शरीरे ॥',
      iast: 'na jāyate mriyate vā vipaścinnāyaṃ kutaścinna babhūva kaścit / ajo nityaḥ śāśvato\'yaṃ purāṇo na hanyate hanyamāne śarīre',
      english: 'The knowing Self is not born, nor does it die. It did not originate from anything, nor did anything originate from it. Unborn, eternal, everlasting, ancient—it is not slain when the body is slain.',
      source: 'Kaṭha Upaniṣad 1.2.18',
      url: 'https://upanishads.org.in/upanishads/3/1/2/18'
    },
    'katha-2-2-12': {
      sanskrit: 'एको वशी सर्वभूतान्तरात्मा एकं रूपं बहुधा यः करोति । तमात्मस्थं येऽनुपश्यन्ति धीरास्तेषां सुखं शाश्वतं नेतरेषाम् ॥',
      iast: 'eko vaśī sarvabhūtāntarātmā ekaṃ rūpaṃ bahudhā yaḥ karoti / tamātmasthaṃ ye\'nupaśyanti dhīrāsteṣāṃ sukhaṃ śāśvataṃ netareṣām',
      english: 'The One Controller, the inner Self of all beings, who makes His one form manifold—the wise who perceive Him as abiding in their own self, to them belongs eternal bliss, not to others.',
      source: 'Kaṭha Upaniṣad 2.2.12',
      url: 'https://upanishads.org.in/upanishads/3/2/2/12'
    },
    'svet-6-11': {
      sanskrit: 'एको देवः सर्वभूतेषु गूढः सर्वव्यापी सर्वभूतान्तरात्मा । कर्माध्यक्षः सर्वभूताधिवासः साक्षी चेता केवलो निर्गुणश्च ॥',
      iast: 'eko devaḥ sarvabhūteṣu gūḍhaḥ sarvavyāpī sarvabhūtāntarātmā / karmādhyakṣaḥ sarvabhūtādhivāsaḥ sākṣī cetā kevalo nirguṇaśca',
      english: 'The One God, hidden in all beings, all-pervading, the inner Self of all beings, the overseer of all actions, dwelling in all beings, the Witness, the conscious one, absolute, and free of attributes.',
      source: 'Śvetāśvatara Upaniṣad 6.11',
      url: 'https://upanishads.org.in/upanishads/9/6/11'
    },
    'bg-2-24': {
      sanskrit: 'अच्छेद्योऽयमदाह्योऽयमक्लेद्योऽशोष्य एव च । नित्यः सर्वगतः स्थाणुरचलोऽयं सनातनः ॥',
      iast: 'acchedyo\'yamadāhyo\'yamakledyo\'śoṣya eva ca / nityaḥ sarvagataḥ sthāṇuracalo\'yaṃ sanātanaḥ',
      english: 'This Self cannot be cut, cannot be burnt, cannot be wetted, cannot be dried. It is eternal, all-pervading, stable, immovable, and everlasting.',
      source: 'Bhagavad Gita 2.24',
      url: 'https://www.gitasupersite.iitk.ac.in/srimad?language=dv&field_chapter_value=2&field_nsutra_value=24'
    },
    'mundaka-3-1-1': {
      sanskrit: 'द्वा सुपर्णा सयुजा सखाया समानं वृक्षं परिषस्वजाते । तयोरन्यः पिप्पलं स्वाद्वत्त्यनश्नन्नन्यो अभिचाकशीति ॥',
      iast: 'dvā suparṇā sayujā sakhāyā samānaṃ vṛkṣaṃ pariṣasvajāte / tayoranyaḥ pippalaṃ svādvattyanaśnannanyo abhicākaśīti',
      english: 'Two birds, inseparable companions, perch on the same tree. One eats the sweet fruit; the other, not eating, simply watches.',
      source: 'Muṇḍaka Upaniṣad 3.1.1',
      url: 'https://upanishads.org.in/upanishads/4/3/1/1'
    },
    'ddv-1': {
      sanskrit: 'रूपं दृश्यं लोचनं दृक्तद्दृश्यं दृक्तु मानसम् । दृश्या धीवृत्तयः साक्षी दृगेव न तु दृश्यते ॥',
      iast: 'rūpaṃ dṛśyaṃ locanaṃ dṛktaddṛśyaṃ dṛktu mānasam / dṛśyā dhīvṛttayaḥ sākṣī dṛgeva na tu dṛśyate',
      english: 'Forms are seen; the eye is the seer. The eye is seen; the mind is the seer. The mental modifications are seen; the Witness alone is the seer—but is never seen.',
      source: 'Dṛg-Dṛśya-Viveka 1',
      url: 'https://www.wisdomlib.org/hinduism/book/drig-drishya-viveka/d/doc238628.html'
    }
  };

  document.addEventListener('DOMContentLoaded', function() {
    var panel = document.getElementById('verse-panel');
    var panelContent = document.getElementById('verse-panel-content');
    var refs = document.querySelectorAll('.verse-ref');

    refs.forEach(function(ref) {
      ref.style.cursor = 'help';
      ref.style.borderBottom = '1px dotted var(--accent-warm)';

      ref.addEventListener('mouseenter', function() {
        var verseId = this.getAttribute('data-verse');
        var verse = verses[verseId];
        if (verse && panel && panelContent) {
          panelContent.innerHTML =
            '<div class="verse-sanskrit">' + verse.sanskrit + '</div>' +
            '<div class="verse-iast">' + verse.iast + '</div>' +
            '<div class="verse-english">' + verse.english + '</div>' +
            '<div class="verse-source"><a href="' + verse.url + '" target="_blank">' + verse.source + ' →</a></div>';
          panel.classList.add('visible');
        }
      });

      ref.addEventListener('mouseleave', function() {
        // keep panel visible for a moment
        setTimeout(function() {
          if (panel) panel.classList.remove('visible');
        }, 300);
      });
    });
  });
</script>
