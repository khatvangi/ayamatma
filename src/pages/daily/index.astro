---
import BaseLayout from '../../layouts/BaseLayout.astro';
import DailyCard from '../../components/DailyCard.astro';
import { getCollection } from 'astro:content';
import { sortByDateDesc } from '../../lib/content';

const lang = 'en';
const entries = (await getCollection('daily')).filter((entry) => entry.data.lang === lang);
const sorted = sortByDateDesc(entries);
const latest = sorted[0];
const archive = sorted.slice(1);
const latestContent = latest ? await latest.render() : null;
---

<BaseLayout title="Daily" description="Three things: a sloka, a term, a question." lang={lang}>
  <section class="section">
    <h1 class="section-title">Daily</h1>
    <p class="muted">Three things: a sloka, a term, a question.</p>
  </section>

  {latest ? (
    <section class="section">
      <DailyCard>
        {latestContent ? <latestContent.Content /> : null}
      </DailyCard>
    </section>
  ) : (
    <div class="card">Daily entries are not yet available.</div>
  )}

  <section class="section">
    <h2 class="section-title">Archive</h2>
    <div class="stack">
      {archive.map((entry) => (
        <div class="card">
          <div class="eyebrow">{entry.data.date}</div>
          <div>{entry.data.sloka_ref} â€¢ {entry.data.term}</div>
          <a class="button" href={entry.data.paths.en}>View</a>
        </div>
      ))}
    </div>
  </section>
</BaseLayout>
